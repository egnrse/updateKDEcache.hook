# updates the KService desktop file configuration cache (for the currently logged in user)
# (by egnrse)
# 
# depends on:
# -'kservice'
# -'archlinux-xdg-menu'
# -'sudo'
# -'coreutils' (provides 'logname')
# put this file into '/etc/pacman.d/hooks/updateKDEcache.hook'
#
# we need the sudo/bash stuff, because hooks are executed by root in a sandboxed environment

[Trigger]
Operation = Install
Operation = Upgrade
Operation = Remove
Type = Path
Target = usr/share/applications/*.desktop

[Action]
Description = Updating the Kservice desktop file configuration cache...
When = PostTransaction
Exec = /bin/bash -c "sudo -u \"$(logname)\" bash -lc 'XDG_MENU_PREFIX=arch- /usr/bin/kbuildsycoca6 --noincremental'"
Depends = sudo
Depends = coreutils
Depends = kservice
Depends = archlinux-xdg-menu
